{{ define "webhooks.yaml.tpl" }}
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: image-admission-config
  namespace: ibm-system
  labels:
    app: {{ template "cise.name" . }}
    chart: {{ template "cise.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
webhooks:
  - name: trust.hooks.securityenforcement.admission.cloud.ibm.com
    clientConfig:
      service:
        name: {{ template "cise.name" . }}
        namespace: ibm-system
        path: "/mutating-pods"
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN6akNDQWJZQ0NRQ2NsbFRWUEFobGhUQU5CZ2txaGtpRzl3MEJBUXNGQURBb01TWXdKQVlEVlFRRERCMXAKWW0xamJHOTFaQzFwYldGblpTMWxibVp2Y21ObGJXVnVkRjlqWVRBZ0Z3MHhPREF6TVRNeE1URTVORFJhR0E4eQpNamt4TVRJeU56RXhNVGswTkZvd0tERW1NQ1FHQTFVRUF3d2RhV0p0WTJ4dmRXUXRhVzFoWjJVdFpXNW1iM0pqClpXMWxiblJmWTJFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURUSFY3SG1TaWYKNDNKZG5vR3lqeFFINGo3emhlMEtabUJVZVZITHltNDE0THdUSjZ5ZmhJdFk3M3J3WEdvRW9kdXR6K0xvalFGWgo4VjhOWkVBM1BnWnpSL1JqejVFa2VSem9rbkdRZ3RZMXQvaTFiQUpXWjF3cE83NlBENTBYNjFOT3ArVU9wdHBZCmZvQ0k2YXFWWThvWWxNYTVHblJRNDNNNk82S28zUE9kSmEvWUp6a0FSRCtKdzVRWlJJRWVaVkZSZUNxRzNOTk0KVzcxSmdzcktMV2RISWc5eXQ4aERvRW0rdWZRSjFock5PR0lmM0ZWSFRTRWp4d2lYZzF6TkxkckU4QlBKOGJwVQpSQnBpTkxIdDdWWHpGTkFKTmRoTUh5TWZTanVoRzk2K3k4QnFhdTN0V1BxRnluc2FiQXUrN2ZiYVFraFg1b051CnNEQjAwekpJTCtrWkFnTUJBQUV3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUxDcGZnWGd1dTNPTGhTRDYxM0YKenRiVjRDdWs3Qi9EWVFzKytaTXlJWjErajdLMWtQVGw5Yk8vcTduMit5ajVFQm96cmNmT2J1Qm5FTTR2Ylh2agpuKzBzR3Y1a3IrK1F2WlQxaXYxYmVaV0pOTmdqUWRyL0N2UzA1eG1hVFJDbURteTJEMlBSeU1ZM1EzbERhQVIrCnhxcFZsTmZXNi9mTnJON2V0cFlZSWEvUzQzOWV3YW9uMkR2eGpaLzBNbHRKMGFvOVNKQWN3czRpUFc4bzRGQTIKSnJWUy9oNlFIU1IwZTJyUDFmcTg0RlIraEVTNFN0RVNycVJiOXUxS1lXV2xQS1IrKytDOU8yekM4aTg2Y3A0cwpaUXlsUWV3Mks1WW1PTkJvbVBxdzR2amNHWG5kbUx3USt4Wm8za25SNnppM1hrTHVFdTJMYk5haTR4c1pkbVVSCnp1Zz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
    rules:
      - operations: [ "CREATE", "UPDATE" ]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources: ["pods", "deployments", "replicationcontrollers", "replicasets", "daemonsets", "statefulsets", "jobs", "cronjobs"]
    failurePolicy: Fail
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: image-admission-config
  namespace: ibm-system
  labels:
    app: {{ template "cise.name" . }}
    chart: {{ template "cise.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
webhooks:
  - name: va.hooks.securityenforcement.admission.cloud.ibm.com
    clientConfig:
      service:
        name: {{ template "cise.name" . }}
        namespace: ibm-system
        path: "/pods"
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN6akNDQWJZQ0NRQ2NsbFRWUEFobGhUQU5CZ2txaGtpRzl3MEJBUXNGQURBb01TWXdKQVlEVlFRRERCMXAKWW0xamJHOTFaQzFwYldGblpTMWxibVp2Y21ObGJXVnVkRjlqWVRBZ0Z3MHhPREF6TVRNeE1URTVORFJhR0E4eQpNamt4TVRJeU56RXhNVGswTkZvd0tERW1NQ1FHQTFVRUF3d2RhV0p0WTJ4dmRXUXRhVzFoWjJVdFpXNW1iM0pqClpXMWxiblJmWTJFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURUSFY3SG1TaWYKNDNKZG5vR3lqeFFINGo3emhlMEtabUJVZVZITHltNDE0THdUSjZ5ZmhJdFk3M3J3WEdvRW9kdXR6K0xvalFGWgo4VjhOWkVBM1BnWnpSL1JqejVFa2VSem9rbkdRZ3RZMXQvaTFiQUpXWjF3cE83NlBENTBYNjFOT3ArVU9wdHBZCmZvQ0k2YXFWWThvWWxNYTVHblJRNDNNNk82S28zUE9kSmEvWUp6a0FSRCtKdzVRWlJJRWVaVkZSZUNxRzNOTk0KVzcxSmdzcktMV2RISWc5eXQ4aERvRW0rdWZRSjFock5PR0lmM0ZWSFRTRWp4d2lYZzF6TkxkckU4QlBKOGJwVQpSQnBpTkxIdDdWWHpGTkFKTmRoTUh5TWZTanVoRzk2K3k4QnFhdTN0V1BxRnluc2FiQXUrN2ZiYVFraFg1b051CnNEQjAwekpJTCtrWkFnTUJBQUV3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUxDcGZnWGd1dTNPTGhTRDYxM0YKenRiVjRDdWs3Qi9EWVFzKytaTXlJWjErajdLMWtQVGw5Yk8vcTduMit5ajVFQm96cmNmT2J1Qm5FTTR2Ylh2agpuKzBzR3Y1a3IrK1F2WlQxaXYxYmVaV0pOTmdqUWRyL0N2UzA1eG1hVFJDbURteTJEMlBSeU1ZM1EzbERhQVIrCnhxcFZsTmZXNi9mTnJON2V0cFlZSWEvUzQzOWV3YW9uMkR2eGpaLzBNbHRKMGFvOVNKQWN3czRpUFc4bzRGQTIKSnJWUy9oNlFIU1IwZTJyUDFmcTg0RlIraEVTNFN0RVNycVJiOXUxS1lXV2xQS1IrKytDOU8yekM4aTg2Y3A0cwpaUXlsUWV3Mks1WW1PTkJvbVBxdzR2amNHWG5kbUx3USt4Wm8za25SNnppM1hrTHVFdTJMYk5haTR4c1pkbVVSCnp1Zz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
    rules:
      - operations: [ "CREATE", "UPDATE" ]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources: ["pods", "deployments", "replicationcontrollers", "replicasets", "daemonsets", "statefulsets", "jobs", "cronjobs"]
    failurePolicy: Fail
{{ end }}
